(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return a(1413)}])},1413:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return Home}});var r=a(5893),s=a(4306),n=a(4718),i=a(7294),o=a(8060),l=a(4758),c=JSON.parse('{"version":"0.1.0","name":"vote_program","instructions":[{"name":"initialize","accounts":[{"name":"programAdmin","isMut":true,"isSigner":false},{"name":"admin","isMut":true,"isSigner":true},{"name":"systemProgram","isMut":false,"isSigner":false}],"args":[]},{"name":"createVoteCard","accounts":[{"name":"voteCard","isMut":true,"isSigner":false},{"name":"author","isMut":true,"isSigner":true},{"name":"systemProgram","isMut":false,"isSigner":false},{"name":"programAdmin","isMut":false,"isSigner":false},{"name":"feeReceiver","isMut":true,"isSigner":false}],"args":[{"name":"title","type":"string"},{"name":"description","type":"string"}]},{"name":"castVote","accounts":[{"name":"voteCard","isMut":true,"isSigner":false},{"name":"voter","isMut":true,"isSigner":true},{"name":"systemProgram","isMut":false,"isSigner":false},{"name":"programAdmin","isMut":false,"isSigner":false}],"args":[]},{"name":"unvote","accounts":[{"name":"voteCard","isMut":true,"isSigner":false},{"name":"voter","isMut":true,"isSigner":true},{"name":"systemProgram","isMut":false,"isSigner":false},{"name":"programAdmin","isMut":false,"isSigner":false}],"args":[]},{"name":"adminRemoveCard","accounts":[{"name":"voteCard","isMut":true,"isSigner":false},{"name":"author","isMut":true,"isSigner":false},{"name":"admin","isMut":true,"isSigner":true},{"name":"programAdmin","isMut":false,"isSigner":false}],"args":[]},{"name":"transferAdmin","accounts":[{"name":"programAdmin","isMut":true,"isSigner":false},{"name":"currentAdmin","isMut":true,"isSigner":true},{"name":"newAdmin","isMut":false,"isSigner":false}],"args":[]},{"name":"updateProgramConfig","accounts":[{"name":"programAdmin","isMut":true,"isSigner":false},{"name":"admin","isMut":true,"isSigner":true}],"args":[{"name":"config","type":{"defined":"FeeConfig"}}]}],"accounts":[{"name":"VoteCard","type":{"kind":"struct","fields":[{"name":"title","type":"string"},{"name":"description","type":"string"},{"name":"author","type":"publicKey"},{"name":"createTime","type":"i64"},{"name":"voteCount","type":"u64"},{"name":"voters","type":{"vec":"publicKey"}}]}},{"name":"ProgramAdmin","type":{"kind":"struct","fields":[{"name":"admin","type":"publicKey"},{"name":"isInitialized","type":"bool"},{"name":"createVoteFee","type":"u64"},{"name":"castVoteFee","type":"u64"},{"name":"feeReceiver","type":"publicKey"},{"name":"adminFeePercent","type":"u8"}]}}],"types":[{"name":"FeeConfig","type":{"kind":"struct","fields":[{"name":"createVoteFee","type":{"option":"u64"}},{"name":"castVoteFee","type":{"option":"u64"}},{"name":"feeReceiver","type":{"option":"publicKey"}},{"name":"adminFeePercent","type":{"option":"u8"}}]}}],"errors":[{"code":6000,"name":"TitleTooLong","msg":"标题长度不能超过50个字符"},{"code":6001,"name":"DescriptionTooLong","msg":"描述长度不能超过280个字符"},{"code":6002,"name":"AlreadyVoted","msg":"您已经投过票了"},{"code":6003,"name":"HasNotVoted","msg":"您还没有投票"},{"code":6004,"name":"UnauthorizedOperation","msg":"只有作者可以执行此操作"},{"code":6005,"name":"InsufficientBalance","msg":"余额不足以支付创建费用"},{"code":6006,"name":"RefundFailed","msg":"退款失败"},{"code":6007,"name":"UnauthorizedAdmin","msg":"未授权的管理员操作"},{"code":6008,"name":"AdminTransferFailed","msg":"管理员转移失败"},{"code":6009,"name":"ProgramNotInitialized","msg":"程序尚未初始化"},{"code":6010,"name":"InvalidFeePercent","msg":"无效的费率百分比"}]}');let d="https://api.devnet.solana.com";var m=a(8764).Buffer;let u=new o.PublicKey("6RcLuYsYfmbfbwkd1bDeFy2MpnU3fUg4NMmWmx5Dy3bE");let VoteProgram=class VoteProgram{static async createVoteCard(e,t,a){let r=new o.Connection(d),s=new l.Y7(r,e,{commitment:"confirmed"}),n=new l.$r(c,u,s);try{let[s]=o.PublicKey.findProgramAddressSync([m.from("program-admin")],u),[i]=o.PublicKey.findProgramAddressSync([m.from("vote-card"),e.publicKey.toBuffer(),m.from(t)],u),l=await n.methods.createVoteCard(t,a).accounts({voteCard:i,author:e.publicKey,programAdmin:s,feeReceiver:s,systemProgram:o.SystemProgram.programId}).rpc();console.log("Transaction signature:",l);let c=await r.getLatestBlockhash();await r.confirmTransaction({signature:l,...c},"confirmed");let d=null,g=10;for(;g>0&&!d;)try{d=await n.account.voteCard.fetch(i),console.log("Vote card created:",d);break}catch(e){if(console.log("Retry attempt ".concat(6-g," to fetch account...")),g--,0===g)throw e;await new Promise(e=>setTimeout(e,2e3))}return i}catch(e){var i;throw console.error("Error in createVoteCard:",e),console.error("Error details:",{message:e.message,logs:e.logs,errorLogs:null===(i=e.logs)||void 0===i?void 0:i.filter(e=>e.includes("Error"))}),e}}static async castVote(e,t){let a=new o.Connection(d),r=new l.Y7(a,e,{commitment:"confirmed"}),s=new l.$r(c,u,r);try{let[r]=o.PublicKey.findProgramAddressSync([m.from("program-admin")],u),n=await s.methods.castVote().accounts({voteCard:t,voter:e.publicKey,programAdmin:r,systemProgram:o.SystemProgram.programId}).rpc();console.log("Vote transaction signature:",n);let i=await a.getLatestBlockhash();return await a.confirmTransaction({signature:n,...i},"confirmed"),n}catch(e){var n;throw console.error("Error in castVote:",e),console.error("Error details:",{message:e.message,logs:e.logs,errorLogs:null===(n=e.logs)||void 0===n?void 0:n.filter(e=>e.includes("Error"))}),e}}static async unvote(e,t){let a=new o.Connection(d),r=new l.Y7(a,e,{commitment:"confirmed"}),s=new l.$r(c,u,r);try{let[r]=o.PublicKey.findProgramAddressSync([m.from("program-admin")],u),n=await s.methods.unvote().accounts({voteCard:t,voter:e.publicKey,programAdmin:r,systemProgram:o.SystemProgram.programId}).rpc();console.log("Unvote transaction signature:",n);let i=await a.getLatestBlockhash();return await a.confirmTransaction({signature:n,...i},"confirmed"),n}catch(e){throw console.error("Error in unvote:",e),e.logs&&console.error("Program logs:",e.logs.join("\n")),e}}static async removeCard(e,t){let a=new o.Connection(d),r=new l.Y7(a,e,{commitment:"confirmed",preflightCommitment:"confirmed"}),s=new l.$r(c,u,r);try{console.log("Removing vote card:",t.toString());let e=await s.methods.removeCard().accounts({voteCard:t,author:r.wallet.publicKey}).rpc();console.log("Remove transaction signature:",e);let n=await a.getLatestBlockhash();return await a.confirmTransaction({signature:e,...n},"confirmed"),e}catch(e){throw console.error("Error removing vote card:",e),e.logs&&console.error("Program logs:",e.logs.join("\n")),Error("Failed to remove vote card: ".concat(e.message))}}static async getAllVoteCards(e){let t=new o.Connection(d),a=new l.Y7(t,e,{commitment:"confirmed",preflightCommitment:"confirmed"}),r=new l.$r(c,u,a);try{let e=await r.account.voteCard.all();return console.log("Found vote cards:",e.length),e.map(e=>{let t=e.account;return{publicKey:new o.PublicKey(e.publicKey),title:t.title,description:t.description,author:t.author,voteCount:t.voteCount,voters:t.voters,createTime:t.createTime}})}catch(e){throw console.error("Error fetching vote cards:",e),Error("Failed to fetch vote cards: ".concat(e.message))}}static async checkProgramInitialized(e){try{let[t]=o.PublicKey.findProgramAddressSync([m.from("program-admin")],u),a=new l.Y7(e,{publicKey:o.PublicKey.default},{commitment:"confirmed"}),r=new l.$r(c,u,a),s=await r.account.programAdmin.fetch(t);return s&&!0===s.isInitialized}catch(e){return console.log("Program not initialized:",e),!1}}static async initializeProgram(e){let t=new o.Connection(d),a=new l.Y7(t,e,{commitment:"confirmed"}),r=new l.$r(c,u,a);try{let[a]=o.PublicKey.findProgramAddressSync([m.from("program-admin")],u),s=await r.methods.initialize().accounts({programAdmin:a,admin:e.publicKey,systemProgram:o.SystemProgram.programId}).rpc(),n=await t.getLatestBlockhash();return await t.confirmTransaction({signature:s,...n},"confirmed"),console.log("Program initialized with tx:",s),s}catch(e){throw console.error("Failed to initialize program:",e),e}}};function Toast(e){let{message:t,type:a,onClose:s,duration:n=3e3}=e;return(0,i.useEffect)(()=>{let e=setTimeout(()=>{s()},n);return()=>clearTimeout(e)},[n,s]),(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 animate-slide-in",children:(0,r.jsxs)("div",{className:"".concat("success"===a?"bg-green-500":"bg-red-500"," text-white px-6 py-3 rounded-lg shadow-lg flex items-center"),children:["success"===a?(0,r.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):(0,r.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),t]})})}function VoteCard(e){var t;let{card:a,onUpdate:n}=e,{wallet:l,publicKey:c,signTransaction:m,signAllTransactions:u}=(0,s.O)(),[g,h]=(0,i.useState)(!1),[p,y]=(0,i.useState)(!1),[f,x]=(0,i.useState)(!1),[v,b]=(0,i.useState)(null),w=a.author.toString(),j=(null==c?void 0:c.toString())===a.author.toString();console.log("Author:",a.author.toString()),console.log("Current user:",null==c?void 0:c.toString()),console.log("Is author:",j);let N=new o.Connection(d);(0,i.useEffect)(()=>{let checkVoteStatus=async()=>{var e;if(!(null==l?void 0:null===(e=l.adapter)||void 0===e?void 0:e.publicKey)||!a.voters)return;let t=l.adapter.publicKey.toString();y(a.voters.some(e=>e.toString()===t))};checkVoteStatus()},[null==l?void 0:null===(t=l.adapter)||void 0===t?void 0:t.publicKey,a.voters]);let handleVote=async()=>{if(l){h(!0);try{let e=await N.getBalance(l.adapter.publicKey);if(e<1e6){b({show:!0,message:"余额不足，投票需要 0.001 SOL",type:"error"});return}let t={publicKey:l.adapter.publicKey,signTransaction:async e=>await m(e),signAllTransactions:async e=>await u(e)};await VoteProgram.castVote(t,new o.PublicKey(a.publicKey)),n(),b({show:!0,message:"投票成功！",type:"success"})}catch(e){console.error("Vote error:",e),e.message.includes("already voted")?b({show:!0,message:"您已经投过票了！",type:"error"}):b({show:!0,message:"投票失败: ".concat(e.message),type:"error"})}finally{h(!1)}}},handleUnvote=async()=>{if(l){h(!0);try{let e={publicKey:l.adapter.publicKey,signTransaction:async e=>await m(e),signAllTransactions:async e=>await u(e)};await VoteProgram.unvote(e,new o.PublicKey(a.publicKey)),n(),y(!1),b({show:!0,message:"已成功取消投票，0.001 SOL 已返还！",type:"success"})}catch(e){console.error("Unvote error:",e),b({show:!0,message:"取消投票失败: ".concat(e.message),type:"error"})}finally{h(!1)}}},handleRemove=async()=>{if(l&&j){h(!0);try{let e={publicKey:l.adapter.publicKey,signTransaction:async e=>await m(e),signAllTransactions:async e=>await u(e)};await VoteProgram.removeCard(e,new o.PublicKey(a.publicKey)),n(),x(!1),b({show:!0,message:"投票已成功删除",type:"success"})}catch(e){console.error("Remove error:",e),b({show:!0,message:"删除失败: ".concat(e.message),type:"error"})}finally{h(!1)}}};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200",children:(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-800 flex-grow",children:a.title}),j&&(0,r.jsx)("button",{onClick:()=>x(!0),className:"text-red-500 hover:text-red-600 p-1 rounded-full hover:bg-red-50 transition-colors duration-200",title:"删除投票",children:(0,r.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,r.jsx)("p",{className:"text-gray-600 mb-4",children:a.description}),(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500 mb-4",children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),(0,r.jsxs)("span",{children:[w.slice(0,4),"...",w.slice(-4)]})]}),(0,r.jsx)("div",{className:"border-t pt-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-blue-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{d:"M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"})}),(0,r.jsxs)("span",{className:"font-bold text-lg text-gray-800",children:[Number(a.voteCount),(0,r.jsx)("span",{className:"text-sm text-gray-500 ml-1",children:"票"})]})]}),(0,r.jsx)("div",{className:"flex gap-2",children:g?(0,r.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):(0,r.jsxs)(r.Fragment,{children:[p?(0,r.jsxs)("button",{onClick:handleUnvote,className:"bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center",disabled:g,children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),"取消投票"]}):(0,r.jsxs)("button",{onClick:handleVote,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center group relative",disabled:g,children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{d:"M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"})}),"投票",(0,r.jsx)("span",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"需要 0.001 SOL"})]}),j&&(0,r.jsxs)("button",{onClick:handleRemove,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center",disabled:g,children:[(0,r.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"删除"]})]})})]})})]})}),f&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"确认删除"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:"确定要删除这个投票吗？此操作不可撤销。"}),(0,r.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,r.jsx)("button",{onClick:()=>x(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",disabled:g,children:"取消"}),(0,r.jsx)("button",{onClick:handleRemove,className:"px-4 py-2 text-white bg-red-500 rounded-md hover:bg-red-600 flex items-center",disabled:g,children:g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):"确认删除"})]})]})}),(null==v?void 0:v.show)&&(0,r.jsx)(Toast,{message:v.message,type:v.type,onClose:()=>b(null)})]})}var g=a(5152),h=a.n(g);function CreateVoteDialog(e){let{isOpen:t,onClose:a,onCreated:n}=e,{wallet:l,signTransaction:c,signAllTransactions:m}=(0,s.O)(),[u,g]=(0,i.useState)(""),[h,p]=(0,i.useState)(""),[y,f]=(0,i.useState)(!1),[x,v]=(0,i.useState)({show:!1,message:"",type:"error"}),b=new o.Connection(d),handleSubmit=async e=>{var t;if(e.preventDefault(),null==l?void 0:null===(t=l.adapter)||void 0===t?void 0:t.publicKey){f(!0);try{let e=await b.getBalance(l.adapter.publicKey);if(e<1e7){v({show:!0,message:"余额不足，创建投票需要 0.01 SOL",type:"error"});return}let t={publicKey:l.adapter.publicKey,signTransaction:async e=>await c(e),signAllTransactions:async e=>await m(e)};await VoteProgram.createVoteCard(t,u,h),n(),a(),g(""),p("")}catch(e){console.error("Create vote error:",e),alert("创建投票失败: ".concat(e.message))}finally{f(!1)}}};return t?(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,r.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"创建新投票"}),(0,r.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,r.jsxs)("form",{onSubmit:handleSubmit,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"标题"}),(0,r.jsx)("input",{type:"text",id:"title",value:u,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,r.jsxs)("div",{className:"mb-6",children:[(0,r.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"描述"}),(0,r.jsx)("textarea",{id:"description",value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,required:!0})]}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{type:"button",onClick:a,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",disabled:y,children:"取消"}),(0,r.jsx)("button",{type:"submit",className:"px-4 py-2 text-white bg-blue-500 rounded-md hover:bg-blue-600 flex items-center",disabled:y,children:y?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):"创建投票"})]})]})]})}):null}let p=h()(async()=>(await a.e(409).then(a.bind(a,2409))).WalletMultiButton,{loadableGenerated:{webpack:()=>[null]},ssr:!1});function Home(){let e=(0,s.O)(),{connection:t}=(0,n.R)(),[a,o]=(0,i.useState)([]),[l,c]=(0,i.useState)(!0),[d,m]=(0,i.useState)(!1),[u,g]=(0,i.useState)("未连接"),[h,y]=(0,i.useState)(!1),[f,x]=(0,i.useState)(null),[v,b]=(0,i.useState)(!1);(0,i.useEffect)(()=>{m(!0)},[]),(0,i.useEffect)(()=>{(async function(){if(!t){g("未连接");return}try{let e=await t.getGenesisHash(),a="未知网络";switch(e){case"EtWTRABZaYq6iMfeYKouRu166VU2xqa1wcaWoxPkrZBG":a="Devnet";break;case"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdpKuc147dw2N9d":a="Mainnet Beta";break;case"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3zQawwpjk2NsNY":a="Testnet"}g(a)}catch(e){console.error("Error getting network:",e),g("连接错误")}})()},[t]),(0,i.useEffect)(()=>{let checkInitialization=async()=>{try{let e=await VoteProgram.checkProgramInitialized(t);x(e)}catch(e){console.error("Failed to check program initialization:",e),x(!1)}};checkInitialization()},[t]);let fetchVoteCards=async()=>{if(null==e?void 0:e.publicKey){c(!0);try{let t={publicKey:e.publicKey,signTransaction:e.signTransaction,signAllTransactions:e.signAllTransactions,payer:null},a=await VoteProgram.getAllVoteCards(t);a.sort((e,t)=>t.createTime-e.createTime),console.log("cards",a),o(a)}catch(e){console.error("Failed to fetch vote cards:",e),alert("获取投票列表失败，请检查网络连接后重试")}finally{c(!1)}}};(0,i.useEffect)(()=>{(null==e?void 0:e.publicKey)?fetchVoteCards():o([])},[null==e?void 0:e.publicKey]);let handleInitialize=async()=>{if(!(null==e?void 0:e.publicKey)){alert("请先连接钱包");return}try{b(!0);let t={publicKey:e.publicKey,signTransaction:e.signTransaction,signAllTransactions:e.signAllTransactions,payer:null},a=await VoteProgram.initializeProgram(t);console.log("Program initialized successfully:",a),x(!0)}catch(e){console.error("Failed to initialize program:",e),alert("初始化程序失败")}finally{b(!1)}};return d?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,r.jsxs)("header",{className:"bg-white shadow-lg rounded-lg p-6 mb-8 flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"投票系统"}),(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["当前网络:"," ",(0,r.jsx)("span",{className:"font-medium bg-blue-100 px-2 py-1 rounded",children:u}),"Devnet"!==u&&(0,r.jsx)("span",{className:"text-red-500 ml-2 bg-red-50 px-2 py-1 rounded",children:"(请切换到 Devnet 网络)"})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[e&&(0,r.jsx)("button",{onClick:()=>y(!0),className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg transition-colors duration-200 flex items-center tooltip-container",title:"创建新投票",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,r.jsx)(p,{})]})]}),(0,r.jsx)(CreateVoteDialog,{isOpen:h,onClose:()=>y(!1),onCreated:()=>{fetchVoteCards(),y(!1)}}),null===f&&(0,r.jsx)("div",{className:"text-center",children:(0,r.jsx)("p",{children:"检查程序状态中..."})}),!1===f&&(0,r.jsxs)("div",{className:"text-center p-4 bg-yellow-100 rounded-lg",children:[(0,r.jsx)("p",{className:"mb-4",children:"程序尚未初始化"}),(0,r.jsx)("button",{onClick:handleInitialize,disabled:!(null==e?void 0:e.publicKey)||v,className:"\n                px-4 py-2 rounded-lg\n                ".concat(v?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600","\n                text-white font-semibold\n              "),children:v?"初始化中...":"初始化程序"})]}),!0===f&&(0,r.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.isArray(a)&&a.map(e=>(0,r.jsx)(VoteCard,{card:e,onUpdate:fetchVoteCards},e.publicKey.toString()))})]})}):null}}},function(e){e.O(0,[655,541,393,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);