(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(1413)}])},1413:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return Home}});var a=r(5893),s=r(4306),o=r(4718),n=r(7294),l=r(8060),i=r(4758),c=JSON.parse('{"version":"0.1.0","name":"vote_program","instructions":[{"name":"createVoteCard","accounts":[{"name":"voteCard","isMut":true,"isSigner":false},{"name":"author","isMut":true,"isSigner":true},{"name":"systemProgram","isMut":false,"isSigner":false}],"args":[{"name":"title","type":"string"},{"name":"description","type":"string"}]},{"name":"castVote","accounts":[{"name":"voteCard","isMut":true,"isSigner":false},{"name":"voter","isMut":true,"isSigner":true},{"name":"systemProgram","isMut":false,"isSigner":false}],"args":[]},{"name":"unvote","accounts":[{"name":"voteCard","isMut":true,"isSigner":false},{"name":"voter","isMut":true,"isSigner":true},{"name":"systemProgram","isMut":false,"isSigner":false}],"args":[]},{"name":"removeCard","accounts":[{"name":"voteCard","isMut":true,"isSigner":false},{"name":"author","isMut":true,"isSigner":true}],"args":[]}],"accounts":[{"name":"VoteCard","type":{"kind":"struct","fields":[{"name":"title","type":"string"},{"name":"description","type":"string"},{"name":"author","type":"publicKey"},{"name":"createTime","type":"i64"},{"name":"voteCount","type":"u64"},{"name":"voters","type":{"vec":"publicKey"}}]}}],"errors":[{"code":6000,"name":"TitleTooLong","msg":"标题长度不能超过50个字符"},{"code":6001,"name":"DescriptionTooLong","msg":"描述长度不能超过280个字符"},{"code":6002,"name":"AlreadyVoted","msg":"您已经投过票了"},{"code":6003,"name":"HasNotVoted","msg":"您还没有投票"},{"code":6004,"name":"UnauthorizedOperation","msg":"只有作者可以执行此操作"},{"code":6005,"name":"InsufficientBalance","msg":"余额不足以支付创建费用"},{"code":6006,"name":"RefundFailed","msg":"退款失败"}]}');let d="https://api.devnet.solana.com";var m=r(8764).Buffer;let u=new l.PublicKey("HpCD3a3oLppiu3C9hGDQreu89UdXitwxgNS7iX2sZM1x");let VoteProgram=class VoteProgram{static async createVoteCard(e,t,r){let a=new l.Connection(d),s=new i.Y7(a,e,{commitment:"confirmed",preflightCommitment:"confirmed"}),o=new i.$r(c,u,s);try{let[s]=l.PublicKey.findProgramAddressSync([m.from("vote-card"),e.publicKey.toBuffer(),m.from(t)],u);console.log("Creating vote card with PDA:",s.toString());let n=await o.methods.createVoteCard(t,r).accounts({voteCard:s,author:e.publicKey,systemProgram:l.SystemProgram.programId}).rpc();console.log("Transaction signature:",n);let i=await a.getLatestBlockhash();await a.confirmTransaction({signature:n,...i},"confirmed");let c=null,d=10;for(;d>0&&!c;)try{c=await o.account.voteCard.fetch(s),console.log("Vote card created:",c);break}catch(e){if(console.log("Retry attempt ".concat(6-d," to fetch account...")),d--,0===d)throw e;await new Promise(e=>setTimeout(e,2e3))}return s}catch(e){var n;throw console.error("Error in createVoteCard:",e),console.error("Error details:",{message:e.message,logs:e.logs,errorLogs:null===(n=e.logs)||void 0===n?void 0:n.filter(e=>e.includes("Error"))}),e}}static async castVote(e,t){let r=new l.Connection(d),a=new i.Y7(r,e,{commitment:"confirmed",preflightCommitment:"confirmed"}),s=new i.$r(c,u,a);try{console.log("Casting vote for:",t.toString()),console.log("Voter:",a.wallet.publicKey.toString()),console.log("System Program ID:",l.SystemProgram.programId.toString());let e=await s.methods.castVote().accounts({voteCard:t,voter:a.wallet.publicKey,systemProgram:l.SystemProgram.programId}).rpc();console.log("Vote transaction signature:",e);let o=await r.getLatestBlockhash();return await r.confirmTransaction({signature:e,...o},"confirmed"),e}catch(e){var o;throw console.error("Error casting vote:",e),console.error("Error details:",{message:e.message,logs:e.logs,errorLogs:null===(o=e.logs)||void 0===o?void 0:o.filter(e=>e.includes("Error"))}),e}}static async unvote(e,t){let r=new l.Connection(d),a=new i.Y7(r,e,{commitment:"confirmed",preflightCommitment:"confirmed"}),s=new i.$r(c,u,a);try{console.log("Unvoting from:",t.toString());let e=await s.methods.unvote().accounts({voteCard:t,voter:a.wallet.publicKey,systemProgram:l.SystemProgram.programId}).rpc();console.log("Unvote transaction signature:",e);let o=await r.getLatestBlockhash();return await r.confirmTransaction({signature:e,...o},"confirmed"),e}catch(e){throw console.error("Error unvoting:",e),e.logs&&console.error("Program logs:",e.logs.join("\n")),e}}static async removeCard(e,t){let r=new l.Connection(d),a=new i.Y7(r,e,{commitment:"confirmed",preflightCommitment:"confirmed"}),s=new i.$r(c,u,a);try{console.log("Removing vote card:",t.toString());let e=await s.methods.removeCard().accounts({voteCard:t,author:a.wallet.publicKey}).rpc();console.log("Remove transaction signature:",e);let o=await r.getLatestBlockhash();return await r.confirmTransaction({signature:e,...o},"confirmed"),e}catch(e){throw console.error("Error removing vote card:",e),e.logs&&console.error("Program logs:",e.logs.join("\n")),Error("Failed to remove vote card: ".concat(e.message))}}static async getAllVoteCards(e){let t=new l.Connection(d),r=new i.Y7(t,e,{commitment:"confirmed",preflightCommitment:"confirmed"}),a=new i.$r(c,u,r);try{let e=await a.account.voteCard.all();return console.log("Found vote cards:",e.length),e.map(e=>{let t=e.account;return{publicKey:new l.PublicKey(e.publicKey),title:t.title,description:t.description,author:t.author,voteCount:t.voteCount,voters:t.voters,createTime:t.createTime}})}catch(e){throw console.error("Error fetching vote cards:",e),Error("Failed to fetch vote cards: ".concat(e.message))}}};function Toast(e){let{message:t,type:r,onClose:s,duration:o=3e3}=e;return(0,n.useEffect)(()=>{let e=setTimeout(()=>{s()},o);return()=>clearTimeout(e)},[o,s]),(0,a.jsx)("div",{className:"fixed top-4 right-4 z-50 animate-slide-in",children:(0,a.jsxs)("div",{className:"".concat("success"===r?"bg-green-500":"bg-red-500"," text-white px-6 py-3 rounded-lg shadow-lg flex items-center"),children:["success"===r?(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}):(0,a.jsx)("svg",{className:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),t]})})}function VoteCard(e){var t;let{card:r,onUpdate:o}=e,{wallet:i,publicKey:c,signTransaction:m,signAllTransactions:u}=(0,s.O)(),[g,h]=(0,n.useState)(!1),[p,x]=(0,n.useState)(!1),[v,y]=(0,n.useState)(!1),[f,w]=(0,n.useState)(null),b=r.author.toString(),j=(null==c?void 0:c.toString())===r.author.toString();console.log("Author:",r.author.toString()),console.log("Current user:",null==c?void 0:c.toString()),console.log("Is author:",j);let C=new l.Connection(d);(0,n.useEffect)(()=>{let checkVoteStatus=async()=>{var e;if(!(null==i?void 0:null===(e=i.adapter)||void 0===e?void 0:e.publicKey)||!r.voters)return;let t=i.adapter.publicKey.toString();x(r.voters.some(e=>e.toString()===t))};checkVoteStatus()},[null==i?void 0:null===(t=i.adapter)||void 0===t?void 0:t.publicKey,r.voters]);let handleVote=async()=>{if(i){h(!0);try{let e=await C.getBalance(i.adapter.publicKey);if(e<1e6){w({show:!0,message:"余额不足，投票需要 0.001 SOL",type:"error"});return}let t={publicKey:i.adapter.publicKey,signTransaction:async e=>await m(e),signAllTransactions:async e=>await u(e)};await VoteProgram.castVote(t,new l.PublicKey(r.publicKey)),o(),w({show:!0,message:"投票成功！",type:"success"})}catch(e){console.error("Vote error:",e),e.message.includes("already voted")?w({show:!0,message:"您已经投过票了！",type:"error"}):w({show:!0,message:"投票失败: ".concat(e.message),type:"error"})}finally{h(!1)}}},handleUnvote=async()=>{if(i){h(!0);try{let e={publicKey:i.adapter.publicKey,signTransaction:async e=>await m(e),signAllTransactions:async e=>await u(e)};await VoteProgram.unvote(e,new l.PublicKey(r.publicKey)),o(),x(!1),w({show:!0,message:"已成功取消投票，0.001 SOL 已返还！",type:"success"})}catch(e){console.error("Unvote error:",e),w({show:!0,message:"取消投票失败: ".concat(e.message),type:"error"})}finally{h(!1)}}},handleRemove=async()=>{if(i&&j){h(!0);try{let e={publicKey:i.adapter.publicKey,signTransaction:async e=>await m(e),signAllTransactions:async e=>await u(e)};await VoteProgram.removeCard(e,new l.PublicKey(r.publicKey)),o(),y(!1),w({show:!0,message:"投票已成功删除",type:"success"})}catch(e){console.error("Remove error:",e),w({show:!0,message:"删除失败: ".concat(e.message),type:"error"})}finally{h(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-200",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800 flex-grow",children:r.title}),j&&(0,a.jsx)("button",{onClick:()=>y(!0),className:"text-red-500 hover:text-red-600 p-1 rounded-full hover:bg-red-50 transition-colors duration-200",title:"删除投票",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:r.description}),(0,a.jsxs)("div",{className:"flex items-center text-sm text-gray-500 mb-4",children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z",clipRule:"evenodd"})}),(0,a.jsxs)("span",{children:[b.slice(0,4),"...",b.slice(-4)]})]}),(0,a.jsx)("div",{className:"border-t pt-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-blue-500 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"})}),(0,a.jsxs)("span",{className:"font-bold text-lg text-gray-800",children:[Number(r.voteCount),(0,a.jsx)("span",{className:"text-sm text-gray-500 ml-1",children:"票"})]})]}),(0,a.jsx)("div",{className:"flex gap-2",children:g?(0,a.jsxs)("div",{className:"flex items-center text-gray-600",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):(0,a.jsxs)(a.Fragment,{children:[p?(0,a.jsxs)("button",{onClick:handleUnvote,className:"bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center",disabled:g,children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})}),"取消投票"]}):(0,a.jsxs)("button",{onClick:handleVote,className:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center group relative",disabled:g,children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{d:"M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"})}),"投票",(0,a.jsx)("span",{className:"absolute -top-8 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white text-xs px-2 py-1 rounded opacity-0 group-hover:opacity-100 transition-opacity duration-200",children:"需要 0.001 SOL"})]}),j&&(0,a.jsxs)("button",{onClick:handleRemove,className:"bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition-colors duration-200 flex items-center",disabled:g,children:[(0,a.jsx)("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:(0,a.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),"删除"]})]})})]})})]})}),v&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:"确认删除"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"确定要删除这个投票吗？此操作不可撤销。"}),(0,a.jsxs)("div",{className:"flex justify-end gap-3",children:[(0,a.jsx)("button",{onClick:()=>y(!1),className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",disabled:g,children:"取消"}),(0,a.jsx)("button",{onClick:handleRemove,className:"px-4 py-2 text-white bg-red-500 rounded-md hover:bg-red-600 flex items-center",disabled:g,children:g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):"确认删除"})]})]})}),(null==f?void 0:f.show)&&(0,a.jsx)(Toast,{message:f.message,type:f.type,onClose:()=>w(null)})]})}var g=r(5152),h=r.n(g);function CreateVoteDialog(e){let{isOpen:t,onClose:r,onCreated:o}=e,{wallet:i,signTransaction:c,signAllTransactions:m}=(0,s.O)(),[u,g]=(0,n.useState)(""),[h,p]=(0,n.useState)(""),[x,v]=(0,n.useState)(!1),[y,f]=(0,n.useState)({show:!1,message:"",type:"error"}),w=new l.Connection(d),handleSubmit=async e=>{var t;if(e.preventDefault(),null==i?void 0:null===(t=i.adapter)||void 0===t?void 0:t.publicKey){v(!0);try{let e=await w.getBalance(i.adapter.publicKey);if(e<1e7){f({show:!0,message:"余额不足，创建投票需要 0.01 SOL",type:"error"});return}let t={publicKey:i.adapter.publicKey,signTransaction:async e=>await c(e),signAllTransactions:async e=>await m(e)};await VoteProgram.createVoteCard(t,u,h),o(),r(),g(""),p("")}catch(e){console.error("Create vote error:",e),alert("创建投票失败: ".concat(e.message))}finally{v(!1)}}};return t?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-md",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-800",children:"创建新投票"}),(0,a.jsx)("button",{onClick:r,className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:handleSubmit,children:[(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"标题"}),(0,a.jsx)("input",{type:"text",id:"title",value:u,onChange:e=>g(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700 mb-1",children:"描述"}),(0,a.jsx)("textarea",{id:"description",value:h,onChange:e=>p(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:4,required:!0})]}),(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:r,className:"px-4 py-2 text-gray-700 bg-gray-100 rounded-md hover:bg-gray-200",disabled:x,children:"取消"}),(0,a.jsx)("button",{type:"submit",className:"px-4 py-2 text-white bg-blue-500 rounded-md hover:bg-blue-600 flex items-center",disabled:x,children:x?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):"创建投票"})]})]})]})}):null}let p=h()(async()=>(await r.e(409).then(r.bind(r,2409))).WalletMultiButton,{loadableGenerated:{webpack:()=>[null]},ssr:!1});function Home(){var e;let{wallet:t}=(0,s.O)(),{connection:r}=(0,o.R)(),[l,i]=(0,n.useState)([]),[c,d]=(0,n.useState)(!0),[m,u]=(0,n.useState)(!1),[g,h]=(0,n.useState)("未连接"),[x,v]=(0,n.useState)(!1);(0,n.useEffect)(()=>{u(!0)},[]),(0,n.useEffect)(()=>{(async function(){if(!r){h("未连接");return}try{let e=await r.getGenesisHash(),t="未知网络";switch(e){case"EtWTRABZaYq6iMfeYKouRu166VU2xqa1wcaWoxPkrZBG":t="Devnet";break;case"5eykt4UsFv8P8NJdTREpY1vzqKqZKvdpKuc147dw2N9d":t="Mainnet Beta";break;case"4uhcVJyU9pJkvQyS88uRDiswHXSCkY3zQawwpjk2NsNY":t="Testnet"}h(t)}catch(e){console.error("Error getting network:",e),h("连接错误")}})()},[r]);let fetchVoteCards=async()=>{var e;if(null==t?void 0:null===(e=t.adapter)||void 0===e?void 0:e.publicKey){d(!0);try{let e={publicKey:t.adapter.publicKey,signTransaction:async e=>e,signAllTransactions:async e=>e,payer:null},r=await VoteProgram.getAllVoteCards(e);r.sort((e,t)=>t.createTime-e.createTime),console.log("cards",r),i(r)}catch(e){console.error("Failed to fetch vote cards:",e),alert("获取投票列表失败，请检查网络连接后重试")}finally{d(!1)}}};return((0,n.useEffect)(()=>{var e;(null==t?void 0:null===(e=t.adapter)||void 0===e?void 0:e.connected)?fetchVoteCards():i([])},[null==t?void 0:null===(e=t.adapter)||void 0===e?void 0:e.connected]),m)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("header",{className:"bg-white shadow-lg rounded-lg p-6 mb-8 flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-800",children:"投票系统"}),(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-2",children:["当前网络:"," ",(0,a.jsx)("span",{className:"font-medium bg-blue-100 px-2 py-1 rounded",children:g}),"Devnet"!==g&&(0,a.jsx)("span",{className:"text-red-500 ml-2 bg-red-50 px-2 py-1 rounded",children:"(请切换到 Devnet 网络)"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[t&&(0,a.jsx)("button",{onClick:()=>v(!0),className:"bg-blue-500 hover:bg-blue-600 text-white p-2 rounded-lg transition-colors duration-200 flex items-center tooltip-container",title:"创建新投票",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,a.jsx)(p,{})]})]}),(0,a.jsx)(CreateVoteDialog,{isOpen:x,onClose:()=>v(!1),onCreated:()=>{fetchVoteCards(),v(!1)}}),c?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Array.isArray(l)&&l.map(e=>(0,a.jsx)(VoteCard,{card:e,onUpdate:fetchVoteCards},e.publicKey.toString()))})]})}):null}}},function(e){e.O(0,[655,541,393,774,888,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);